<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaper Tracker: Estancos y Bazares Chinos</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --accent: #2563eb; --bazar: #facc15; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Outfit', sans-serif; }
        #map { height: 100vh; width: 100%; }

        .info-header {
            position: absolute; top: 15px; left: 50%; transform: translateX(-50%);
            z-index: 2000; background: #1e293b; color: white; padding: 12px 24px; 
            border-radius: 50px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); 
            font-weight: 700; font-size: 11px; text-align: center; border: 1px solid var(--bazar);
        }

        .leaflet-popup-content-wrapper { border-radius: 16px; padding: 8px; }
        .popup-card { text-align: center; min-width: 170px; }
        .type-badge { font-size: 9px; font-weight: 800; padding: 4px 8px; border-radius: 5px; text-transform: uppercase; margin-bottom: 5px; display: inline-block; }
        
        .badge-estanco { background: #fee2e2; color: #991b1b; } 
        .badge-bazar { background: #fef9c3; color: #854d0e; border: 1px solid #facc15; }  
        .badge-gas { background: #ffedd5; color: #9a3412; }

        .btn-google {
            display: block; background: #4285F4; color: white; text-decoration: none; 
            padding: 10px; border-radius: 10px; font-weight: 700; margin-top: 10px; font-size: 12px;
        }
    </style>
</head>
<body>

    <div class="info-header">‚≠ê ESPECIAL VAPERS: ESTANCOS Y BAZARES CHINOS</div>
    <div id="map"></div>

    <script>
        var map = L.map('map', { zoomControl: false }).setView([40.41, -3.70], 6);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

        const createIcon = (color) => L.icon({ 
            iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34] 
        });

        const icons = { red: createIcon('red'), gold: createIcon('gold'), orange: createIcon('orange') };

        map.locate({setView: true, maxZoom: 15});
        map.on('locationfound', function(e) {
            const radio = 3000;
            // BUSCAMOS: Estancos (tobacco) y Bazares (variety_store, convenience, supermarket)
            const query = `[out:json];(
                node["shop"="tobacco"](around:${radio},${e.latlng.lat},${e.latlng.lng});
                node["shop"="variety_store"](around:${radio},${e.latlng.lat},${e.latlng.lng});
                node["shop"="convenience"](around:${radio},${e.latlng.lat},${e.latlng.lng});
                node["shop"="supermarket"](around:${radio},${e.latlng.lat},${e.latlng.lng});
                node["amenity"="fuel"](around:${radio},${e.latlng.lat},${e.latlng.lng});
            );out;`;

            fetch("https://overpass-api.de/api/interpreter?data=" + encodeURIComponent(query))
            .then(r => r.json()).then(d => {
                d.elements.forEach(p => {
                    let tipo = "Bazar Chino", icono = icons.gold, clase = "badge-bazar";

                    if(p.tags.shop === "tobacco") {
                        tipo = "Estanco Oficial"; icono = icons.red; clase = "badge-estanco";
                    } else if(p.tags.amenity === "fuel") {
                        tipo = "Gasolinera"; icono = icons.orange; clase = "badge-gas";
                    }

                    var searchUrl = `https://www.google.com/maps/search/${encodeURIComponent(p.tags.name || tipo)}+${p.lat},${p.lon}`;

                    L.marker([p.lat, p.lon], {icon: icono}).addTo(map).bindPopup(`
                        <div class="popup-card">
                            <span class="type-badge ${clase}">${tipo}</span>
                            <h3 style="margin:5px 0; font-size:15px;">${p.tags.name || "Bazar Alimentaci√≥n"}</h3>
                            <p style="font-size:11px; color:#666;">üí® Venta de Vapers 24h/Extendido</p>
                            <a href="${searchUrl}" target="_blank" class="btn-google">VER HORARIO EN GOOGLE</a>
                        </div>
                    `);
                });
            });
        });
    </script>
</body>
</html>
